---
const success = Astro.url.searchParams.get("success");
---

<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Registro de Invitados</title>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&display=swap" rel="stylesheet">

    <style>
      body {
        margin: 0;
        height: 100vh;
        background: radial-gradient(circle at center, #2b1d12 0%, #120c07 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: "Cinzel", serif;
        color: #d4af37;
      }

      .register-container {
        background: #1a120c;
        border: 2px solid #b8860b;
        padding: 40px;
        width: 420px;
        box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
        text-align: center;
        position: relative;
      }

      h1 {
        margin-bottom: 25px;
        font-size: 26px;
        letter-spacing: 1px;
      }

      input {
        width: 93%;
        padding: 12px;
        margin-bottom: 15px;
        background: #2b1d12;
        border: 1px solid #b8860b;
        color: #fff;
        font-size: 14px;
      }

      input:focus {
        outline: none;
        border-color: #ffd700;
        box-shadow: 0 0 8px rgba(255, 215, 0, 0.6);
      }

      button {
        width: 100%;
        padding: 12px;
        background: linear-gradient(145deg, #b8860b, #8b6508);
        border: none;
        color: #000;
        font-weight: bold;
        cursor: pointer;
        transition: 0.2s ease;
      }

      button:hover {
        background: linear-gradient(145deg, #ffd700, #b8860b);
        transform: scale(1.03);
      }

      .success-message {
        margin-top: 15px;
        font-size: 14px;
        color: #7CFC00;
      }

      .footer-text {
        margin-top: 20px;
        font-size: 12px;
        color: #a68b5b;
      }
      select {
        width: 100%;
        padding: 12px;
        margin-bottom: 15px;

        background: #2b1d12;
        border: 1px solid #b8860b;
        color: #fff;
        font-size: 14px;
        font-family: "Cinzel", serif;

        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;

        cursor: pointer;

        /* Flecha personalizada */
        background-image: url("data:image/svg+xml;utf8,<svg fill='%23d4af37' height='20' viewBox='0 0 24 24' width='20' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
        background-repeat: no-repeat;
        background-position: right 12px center;
        background-size: 18px;
        }

        select:focus {
        outline: none;
        border-color: #ffd700;
        box-shadow: 0 0 8px rgba(255, 215, 0, 0.6);
        }

        select option {
        background-color: #1a120c;
        color: #fff;
        }

    </style>
  </head>

  <body>
    <div class="register-container">
      <h1>Registro del Reino</h1>

      <form id="registroForm" autocomplete="off">
        <input 
          type="text" 
          name="nickInvitado" 
          placeholder="Nick del Invitado" 
          maxlength="30"
          required 
        />

        <input 
          type="text" 
          name="nickInvitador" 
          placeholder="Nick del Invitador" 
          maxlength="30"
          required 
        />
        <select name="rolDiscord" id="rolDiscord">
            <option value="">Rol en Discord de Alopecia</option>
            <option value="GREMIO">GREMIO</option>
            <option value="INVITADO">INVITADO</option>
        </select>

        <button type="submit">Registrar Guerrero</button>
      </form>

      {success && (
        <div class="success-message">
          Invitado registrado con éxito ⚔️
        </div>
      )}

      <div class="footer-text">
        ALOPECIA • Sistema Público
      </div>

      <div class="footer-text">
        Iniciar sesión <a href="/">Click Here</a>
      </div>

    </div>
  </body>
</html>

<script>
  const form = document.getElementById("registroForm");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);

    try {
      const response = await fetch("/api/invitados", {
        method: "POST",
        body: formData
      });

      const data = await response.json();

      if (response.ok) {
        mostrarMensaje("Invitado registrado con éxito ⚔️", "success");
        form.reset();
      } else {
        mostrarMensaje(data.error || "Error al registrar", "error");
      }

    } catch (err) {
      mostrarMensaje("Error de conexión", "error");
    }
  });

  function mostrarMensaje(texto, tipo) {
    let mensaje = document.getElementById("mensaje");

    if (!mensaje) {
      mensaje = document.createElement("div");
      mensaje.id = "mensaje";
      mensaje.style.marginTop = "15px";
      mensaje.style.fontSize = "14px";
      form.appendChild(mensaje);
    }

    mensaje.textContent = texto;

    if (tipo === "success") {
      mensaje.style.color = "#7CFC00";
    } else {
      mensaje.style.color = "#ff4d4d";
    }

    /*setTimeout(() => {
        window.location.reload();
    }, 1500);*/

  }
</script>
